<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link id="theme" rel="stylesheet" href="../bootstrap_quartz.css">
    <title>Document</title>

    <style>
        .error{
            color: orange; 
            font-weight:700; 
            margin: 10px 0px;
        }
    </style>
</head>

<body>
    <div id="modalToggle2"></div>
    <div class="modal fade" id="exampleModalToggle" aria-hidden="true" aria-labelledby="exampleModalToggleLabel"
        tabindex="-1" data-bs-backdrop="static">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalToggleLabel">Регистрация</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form>
                        <div class="mb-2">
                            <label for="recipient-name" class="col-form-label">Имя:</label>
                            <input type="text" class="form-control" id="name">
                            <div id="nameErr" class="error">
                            </div>
                        </div>
                        <div class="mb-2">
                            <label for="recipient-name" class="col-form-label">Адрес электронной почты:</label>
                            <input type="email" class="form-control" id="email">
                            <div id="emailErr" class="error">
                            </div>
                        </div>
                        <div class="mb-2">
                            <label for="recipient-name" class="col-form-label">Придумайте пароль:</label>
                            <input type="password" class="form-control" id="password">
                            <div id="passwordErr" class="error">
                            </div>
                        </div>
                        <div class="mb-2">
                            <label for="recipient-name" class="col-form-label">Повторите пароль:</label>
                            <input type="password" class="form-control" id="retype_password">
                            <div id="passwordErr2" class="error">
                            </div>
                        </div>
                        <div class="input-group mb-2">
                            <div class="input-group-text">
                                <input class="form-check-input mt-0" type="checkbox" value="" id="policy"
                                    aria-label="Checkbox for following text input">
                                <label for="policy" class="col-form-label">Согласие на обработку персональных
                                    данных</label>
                                
                            </div>
                            <div id="policyErr" class="error"></div>
                        </div>
                        <div class="input-group mb-2">
                            <div class="input-group-text">
                                <input class="form-check-input mt-0" type="checkbox" value="" id="newsletter">
                                <label for="newsletter" class="col-form-label">Хочу получать рассылку</label>
                                <div id="error" class="error">
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer" id="modal-footer">
                    <button id="sendBtn" type="button" class="btn btn-primary">Send</button>

                    <!-- <button id="sendBtn2" class="btn btn-primary" data-bs-target="#exampleModalToggle2" data-bs-toggle="modal"
                        data-bs-dismiss="modal">Send</button> -->
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="exampleModalToggle2" aria-hidden="true" aria-labelledby="exampleModalToggleLabel2"
        tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalToggleLabel2">Регистрация</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    Спасибо за регистрацию!
                </div>
                <div class="modal-footer">
                    <!-- <button class="btn btn-primary" data-bs-target="#exampleModalToggle" data-bs-toggle="modal"
                        data-bs-dismiss="modal">Перейти в личный кабинет</button> -->
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    <a class="btn btn-primary" data-bs-toggle="modal" href="#exampleModalToggle" role="button">Зарегистрироваться</a>


    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"
        integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous">
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"
        integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous">
    </script>

    <script>

        let form = {}

        sendBtn.onclick = function (e) {
            e.preventDefault();
            
            clearErr ();

            let result = validateName() & validateEmail() & validatePassword() & validateTerms() & validateNews();
            
            if (result) {

                //document.getElementById("error").innerHTML = "Спасибо за регистрацию!";

                document.getElementById('modal-footer').innerHTML = '';
                let str = ''
                str += `<button id="sendBtn2" class="btn btn-success" data-bs-target="#exampleModalToggle2" data-bs-toggle="modal"
                        data-bs-dismiss="modal">Success! Send!</button>`
                document.getElementById('modal-footer').innerHTML = str;
            } else {
                document.getElementById('modal-footer').innerHTML = '';
                let err = ''
                err += `<button id="sendBtn2" type="button" class="btn btn-danger">Error! Fix it!</button>`
                document.getElementById('modal-footer').innerHTML = err;

                btn2();
            }
        }

        const btn2 = () => {
            sendBtn2.onclick = function (e) {
                e.preventDefault();

                clearErr ();

                let result = validateName() & validateEmail() & validatePassword() & validateTerms() & validateNews();

                if (result) {
                    document.getElementById('modal-footer').innerHTML = '';
                    let str = ''
                    str += `<button id="sendBtn2" class="btn btn-success" data-bs-target="#exampleModalToggle2" data-bs-toggle="modal"
                        data-bs-dismiss="modal">Success! Send!</button>`
                    document.getElementById('modal-footer').innerHTML = str;
                }
            }
        }

        const clearErr = () =>{
            document.getElementById("error").innerHTML = '';
                document.getElementById("nameErr").innerHTML = '';
                document.getElementById("emailErr").innerHTML = '';
                document.getElementById("passwordErr").innerHTML = '';
                document.getElementById("passwordErr2").innerHTML = '';
                document.getElementById("policyErr").innerHTML = '';
        }

        function validateName() {
            let name = document.getElementById("name").value;
            if (name === "") {
                document.getElementById("nameErr").innerHTML = "Имя не заполнено.<br>";
                return false;
            } else if (name.length < 2) {
                document.getElementById("nameErr").innerHTML = "Имя должно содержать как минимум 2 символа.<br>";
                return false;
            } else {
                form.name = name;
                return true;
            };
        }

        function validateEmail() {
            let email = document.getElementById("email").value;
            let emailFormat = /^[A-Z0-9._%+-]+@[A-Z0-9-]+.+.[A-Z]{2,4}$/i;
            if (email === "") {
                document.getElementById("emailErr").innerHTML = "Адрес электронной почты не заполнен.<br>";
                return false;
            } else if (email.match(emailFormat)) {
                form.email = email;
                return true;
            } else {
                document.getElementById("emailErr").innerHTML = "Адрес электронной почты недействителен.<br>";
                return false;
            }
        }

        function validatePassword() {
            let password = document.getElementById("password").value;
            let retype = document.getElementById("retype_password").value;
            let passwordFormat = /^((?=\S*?[A-Z])(?=\S*?[a-z])(?=\S*?[0-9]).{6,})\S$/;
            if (password === "") {
                document.getElementById("passwordErr").innerHTML = "Пароль не заполнен.<br>";
                return false;
            } else if (password.match(passwordFormat)) {
                if (password !== retype) {
                    document.getElementById("passwordErr2").innerHTML = "Пароли не совпадают.<br>";
                    return false;
                } else {
                    form.password = password;
                    return true;
                };
            } else {
                document.getElementById("passwordErr").innerHTML =
                    "Пароль должен быть на английском языке и состоять как минимум из 6 символов, 1 заглавной буквы, 1 строчной и 1 цифре без пробелов.<br>";
                return false;
            }
        }

        function validateTerms() {
            let terms = document.getElementById("policy");
            if (!terms.checked) {
                document.getElementById("policyErr").innerHTML =
                    "Примите Пользовательское соглашение для регистрации.<br>";
                return false;
            } else {
                form.terms = terms.checked;
                return true;
            };
        }

        function validateNews() {
            let newsletter = document.getElementById("newsletter");
            form.newsletter = newsletter.checked;
            return true;
        }
    </script>
</body>

</html>